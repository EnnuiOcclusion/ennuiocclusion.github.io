<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Logic Programming Silent Hill 3</title>
  <meta name="description" content="Convergent CirclesEvery now and then you find an interesting overlap in diverse interests and it seems worth taking note of.Logic ProgrammingI've been very interested in logic programming using Min..." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@ennuiocclusion" />
    <meta name="twitter:title" content="Logic Programming Silent Hill 3" />
    <meta name="twitter:image" content="https://ennuiocclusion.github.io/assets/images/eo_logo.jpg" />
    
    <meta name="twitter:description"  content="Convergent CirclesEvery now and then you find an interesting overlap in diverse interests and it seems worth taking note of.Logic ProgrammingI've been very interested in logic programming using Min..." />
    
  
  
  <meta property="og:site_name" content="Ennui Occlusion" />
  <meta property="og:title" content="Logic Programming Silent Hill 3"/>
  
  <meta property="og:description" content="Convergent CirclesEvery now and then you find an interesting overlap in diverse interests and it seems worth taking note of.Logic ProgrammingI've been very interested in logic programming using Min..." />
  
  <meta property="og:image" content="https://ennuiocclusion.github.io/assets/article_images/sh_logic/puzzle_1_small.png" />
  <meta property="og:url" content="https://ennuiocclusion.github.io/2018/01/11/logic-programming-silent-hill-3.html" >
  <meta property="og:type" content="blog" />
  <meta property="article:published_time" content="2018-01-11T10:48:00-08:00">

  <link rel="canonical" href="https://ennuiocclusion.github.io/2018/01/11/logic-programming-silent-hill-3.html"/>
  <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/png"/>
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>

  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->


  <a href="https://ennuiocclusion.github.io" class="logo-readium"><span class="logo" style="background-image: url(/assets/images/eo_logo.jpg)"></span></a>

<!-- header end -->

    <main class="content" role="main">
      <article class="post">
        
        <div class="article-image">
          <div class="post-image-image" style="background-image: url(/assets/article_images/sh_logic/puzzle_1_small.png)">
            Article Image
          </div>
          <div class="post-image-image2" style="background-image: url(/assets/article_images/sh_logic/puzzle_1_small.png)">
            Article Image
          </div>
          <div class="post-meta">
            <h1 class="post-title">Logic Programming Silent Hill 3</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Peter Morris</h4>
              on
              <time datetime="2018-01-11 10:48">11 Jan 2018</time>
            </div>
            <div style="text-align:center">
              <a href="#topofpage" class="topofpage"><i class="fa fa-angle-down"></i></a>
            </div>
          </div>
        </div>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <h1>Convergent Circles</h1>
<p>Every now and then you find an interesting overlap in diverse interests and it seems worth taking note of.</p>
<h2>Logic Programming</h2>
<p>I've been very interested in logic programming using MiniKannren after watching the presentation <a href="https://www.youtube.com/watch?v=OyfBQmvr2Hc">The Most Beautiful Program Ever Written</a>. Logic programming requires a completely different mind-set going in. The functional approach at its most basic level consists of describing functions with which you can build up an answer. Logic program entails beginning with a set of unbound variables, which equate to any possible value, then constraing their possible values down until you have an answer.</p>
<h2>Silent Hill</h2>
<p>Silent Hill is a video game franchise published by Konami. While there is a lot to say about use and abuse of the license over time it is widely agreed that the original trilogy are masterpieces of the horror genre. Instead of going for cheap jump scares they make the player confront nightmarish horrors which are truly terrifying and confounding to comprehend.</p>
<blockquote>
  <p>A small, beautiful little team of passionate rejects and failures got their chance to make a spooky game followed up by arguably the most brilliant and beautifully crafted survival horror game ever made.</p>
  <p>&#8211; <a href="https://www.youtube.com/watch?v=hycpdjjcnRE">NakeyJakey</a></p>
</blockquote>
<p>Silent Hill games are built largely on two game mechanics. Combatting monsters and solving puzzles. At the start of every game the player must choose difficulty settings for these two components independently of each other. The puzzles in the game actually change their text based on how much of a mental challenge you want.</p>
<p>I think this incorporation of puzzles actually helps enhance the horror you experience quite well. You are forced to engage the game with the very rational and logical parts of your brain. The same parts of your brain which fail to understand the horrific logic put forward by a nightmarish hellscape.</p>
<h1>Programming Our Way Into The Hospital</h1>
<p>Now to bring these two concepts together. In Silent Hill 3 after arriving at the town of Silent Hill proper you are left to once again explore the Brookhaven Hospital you explored previously in Silent Hill 2. Things have changed just enough from your previous visit to leave you uncomfortable.</p>
<p>After making your way to the second floor and battling with sexy-zombie-bobble-head-nurses you are confronted with a locked door with a nine digit key pad and a riddle with its key combination.</p>
<blockquote>
  <p>The first is larger than the second;
    the second twice the third;
    the third smaller than the fourth;
    the fourth is half the first.</p>
  <p>Four of the numbers
    are not repeated
    Three are not in the top row
    Two are not in the right row
    One of the numbers is the final key</p>
</blockquote>
<p>Deciphering this riddle requires following logical constraints and making relationships between the digits &#8211; a problem perfectly in the domain of logic based programming! So without further ado, let's code!</p>
<h1>Setting Things Up</h1>
<p>First we make a new Clojure app with leiningen with:</p>
<pre class="src" lang="bash">
lein new app sh-logic
</pre>
<p>Next, we need to include the core.logic library in our Clojure project. So we change our <code>project.clj</code> file to have the following dependencies:</p>
<pre class="src" lang="clojure">
:dependencies [[org.clojure/clojure &quot;1.9.0&quot;]
               [org.clojure/core.logic &quot;0.8.11&quot;]]
</pre>
<p>Install our dependencies:</p>
<pre class="src" lang="bash">
lein deps
</pre>
<p>And finally we get our <code>src/sh_logic/core.clj</code> ready to write logic code by using the <code>core.logic</code> and requiring the <code>core.logic.fd</code> libraries:</p>
<pre class="src" lang="clojure">
(ns sh-logic.core
  (:gen-class)
  (:refer-clojure :exclude [==])
  (:use [clojure.core.logic])
  (:require [clojure.core.logic.fd :as fd]))
</pre>
<h1>Getting Logical</h1>
<p>What we're actually after here is a function we can call which will return the answer to our puzzle. It should ask the core.logic solver to find all values for q which could be our answer. So let's make that:</p>
<pre class="src" lang="clojure">
(defn solve-puzzle []
  (run* [q]

    ))
</pre>
<p>All of our following code will go inside this run* statement.</p>
<h2>Defining q</h2>
<p>At this point q is an unbound variable which could be anything. That's not very helpful. So let's tell core.logic what q should be, a list of four variables holding our answer. We introduce the new variables representing each digit with <code>fresh</code>. We then unify the list of these digits with q using <code>==</code>.</p>
<pre class="src" lang="clojure">
(fresh [a b c d]
  (== q [a b c d]))
</pre>
<p>At this point running our program gives us the following output:</p>
<pre class="src" lang="clojure">
([_0 _1 _2 _3])
</pre>
<p>Roughly translated this means our answer is a list of four variables which could be anything.</p>
<h2>Limiting to a Finite Domain</h2>
<p>Now we know that our unbound variables can't be literally any value. They each have to be one of the values 1 through 9. We can apply this constraint to our answers with the <code>fd/in</code> function. This lets us define a <code>fd/domain</code>, which is a list of numbers that are possible values. We can then apply this constratint over our list of numbers with the <code>everyg</code> function which lets us apply this constraint over a list of variables.</p>
<pre class="src" lang="clojure">
(everyg #(fd/in % (fd/domain 1 2 3 4 5 6 7 8 9)) [a b c d])
</pre>
<p>Now the ouput of our function looks like this:</p>
<pre class="src" lang="clojure">
([1 1 1 1] [2 1 1 1] [1 2 1 1] [3 1 1 1] [1 1 2 1] [2 2 1 1] [1 1 1 2] [1 3 1 1] [4 1 1 1] [2 1 2 1] [1 2 2 1] [1 1 1 3] ...)
</pre>
<p>This is a list of every possible combination of four digit numbers. Very interesting!</p>
<h2>The first is larger than the second;</h2>
<p>Now we can start describing relationships amongst our variables. <code>core.logic.fd</code> has a few different operator which map directly to the relationships of the riddle. The following is almost a direct trasncription of this line into code:</p>
<pre class="src" lang="clojure">
(fd/&gt; a b)
</pre>
<p>Now our output is as follows:</p>
<pre class="src" lang="clojure">
([2 1 1 1] [3 1 1 1] [2 1 2 1] [2 1 1 2] [4 1 1 1] [3 2 1 1] ...)
</pre>
<p>Notice that any value where the first digit is less than or equal to the second digit is gone.  We're finally getting somewhere.</p>
<h2>the second twice the third;</h2>
<p>We can once again use a <code>core.logic.fd</code> constraint to directly transcribe this line:</p>
<pre class="src" lang="clojure">
(fd/* c 2 b)
</pre>
<p>Our output is now pruned to satisfying these constraints:</p>
<pre class="src" lang="clojure">
([3 2 1 1] [4 2 1 1] [3 2 1 2] [3 2 1 3] [5 2 1 1] [3 2 1 4] ...)
</pre>
<h2>the third smaller than the fourth; the fourth is half the first.</h2>
<p>Now it's just the same gag for these next two lines, so let's get them in one go.</p>
<pre class="src" lang="clojure">
(fd/&lt; c d)
(fd/* d 2 a)
</pre>
<p>This leads us to the following ouput:</p>
<pre class="src" lang="clojure">
([4 2 1 2] [6 2 1 3] [8 2 1 4] [6 4 2 3] [8 4 2 4] [8 6 3 4])
</pre>
<p>Aha! We're getting close.</p>
<h2>Four of the numbers are not repeated</h2>
<p>This calls for a new type of constraint &#8211; <code>fd/distinct</code>. This ensures that no two variables have the same value.</p>
<p>On a side note this constraint is the basis for an absurdly terse Sudoku solver where you simply split the puzzle into rows, columns, and squares then ensure they are all distinct.</p>
<p>For now, let's constrain our digits.</p>
<pre class="src" lang="clojure">
(fd/distinct [a b c d])
</pre>
<p>Which leaves us dangerously close to a solution:</p>
<pre class="src" lang="clojure">
([6 2 1 3] [8 2 1 4] [6 4 2 3] [8 6 3 4])
</pre>
<h2>Three are not in the top row</h2>
<p>This line is particulary tricky in wording and difficult to implement. The top row are the values <code>1 2 3</code>. This means that one number may or may not be 3 or less. It would be quite simple to at this point just write a predicate function and filter over the output of our logic program. I want to however solve this puzzle entirely using logic.</p>
<p>My current solution is as follows:</p>
<ol>
  <li>Create four new logic variables</li>
  <li>Attach each to one of the original four variables</li>
  <li>Ensure that the first is less than the other three, the second less than the next two, and the third less than the fourth</li>
  <li>Ensure that the second of these is greater than 3</li>
</ol>
<p>That is, sort the numbers then make sure that the three largest are greater than three. In code this is:</p>
<pre class="src" lang="clojure">
(fresh [l1 l2 l3 l4]
  (everyg #(membero % q) [l1 l2 l3 l4])
  (fd/distinct [l1 l2 l3 l4])
  (fd/&lt; l1 l2)
  (fd/&lt; l1 l3)
  (fd/&lt; l1 l4)
  (fd/&lt; l2 l3)
  (fd/&lt; l2 l4)
  (fd/&lt; l3 l4)
  (fd/&gt; l2 3))
</pre>
<p>This finally gives us a single solution:</p>
<pre class="src" lang="clojure">
([8 6 3 4])
</pre>
<p>Entering this code opens the door and let's us continue on.</p>
<h2>All Together Now</h2>
<p>The complete code is available at <a href="https://github.com/EnnuiOcclusion/sh-logic">https://github.com/EnnuiOcclusion/sh-logic</a>.</p>
<h1>Next Steps</h1>
<p>I like the creativity of that last solution, but I'd like something more expressive. I'd like to both generalize lvar sorting into a function called <code>sorto</code> and also come up with a constraint which roughly translates to &#8220;ensure that only one member of q is in the set [1 2 3]&#8221;. Any help on this is appreciated. I'll update if I find either of these.</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=Logic+Programming+Silent+Hill+3&amp;url=https://ennuiocclusion.github.io/2018/01/11/logic-programming-silent-hill-3"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/author.jpg)">Blog Logo</div>
              <h4>Peter Morris</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2018-01-11 10:48">11 Jan 2018</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Peter Morris</a> &copy; 2018<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'ennuiocclusion'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/space_background_image.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Ennui Occlusion</h1>
        <h2 class="blog-description">Exploring ideas of interest.
</h2>
        <a href=/ class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>


  </body>
</html>
